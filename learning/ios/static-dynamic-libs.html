<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-learning docs-doc-id-ios/static-dynamic-libs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-91G2XYQTXS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-91G2XYQTXS",{})</script><title data-rh="true">Статические и динамические библиотеки/фреймворки в iOS | Kotlin Multiplatform Mobile</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kmm.icerock.dev/learning/ios/static-dynamic-libs"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-learning-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-learning-current"><meta data-rh="true" property="og:title" content="Статические и динамические библиотеки/фреймворки в iOS | Kotlin Multiplatform Mobile"><meta data-rh="true" name="description" content="Введение"><meta data-rh="true" property="og:description" content="Введение"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kmm.icerock.dev/learning/ios/static-dynamic-libs"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/learning/ios/static-dynamic-libs" hreflang="en"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/learning/ios/static-dynamic-libs" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e3f3aea4.css">
<link rel="preload" href="/assets/js/runtime~main.12c44d84.js" as="script">
<link rel="preload" href="/assets/js/main.295e8f0e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/onboarding/intro">Onboarding</a><a class="navbar__item navbar__link navbar__link--active" href="/learning/intro">Knowledge Base</a><a class="navbar__item navbar__link" href="/university/intro">University</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/icerockdev/kmm.icerock.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/intro">О разделе</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/code-style/general-rules">CodeStyle</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/gradle/intro-gradle">Gradle</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/android/study-materials">Android</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/learning/ios/study-materials">iOS</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/study-materials">Материалы для обучения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/background_state">Background State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/configuration">Конфигурации сборки проекта</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/corners">Layer corners</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/dispatchqueue">Dispatch Queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/forced_fcm_invalidation">Forced FCM-token invalidation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/navigation">Навигация</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/pods">CocoaPods</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/sign_in_with_apple">Sign in with Apple</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/learning/ios/static-dynamic-libs">Статические и динамические библиотеки/фреймворки в iOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/xcode-environment-variables">Xcode - environment variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/learning/ios/xcode">Xcode</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/kotlin/study-materials">Kotlin</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/kotlin-multiplatform/how-to-start">Kotlin Multiplatform</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/kotlin-native/summary">Kotlin/Native</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/libraries/kotlinx/coroutines">Библиотеки</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/learning/problem-solving/gradle-daemon-crash">Решения проблем</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/memory_management">Работа с памятью</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/concurrency">Многопоточность</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/links">Ссылки</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/learning/code">Примеры кода</a></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">iOS</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Статические и динамические библиотеки/фреймворки в iOS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Статические и динамические библиотеки/фреймворки в iOS</h1><h3 class="anchor anchorWithStickyNavbar_mojV" id="введение">Введение<a class="hash-link" href="#введение" title="Direct link to heading">​</a></h3><p>При разработке приложений на любой платформе (в том числе и iOS) мы сталкиваемся с тем, что нам приходится использовать сторонний код или
упаковывать свой собственный код, чтобы потом его переиспользовать.</p><p>Почти все iOS разработчики в какой-то мере работают или работали со статическими и динамическими фреймворками, но не до конца понимают их
особенности.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="определения">Определения<a class="hash-link" href="#определения" title="Direct link to heading">​</a></h3><p>Разберемся для начала с основными понятиями данной статьи.
<strong>Библиотека</strong> - это кодовая база, строительный элемент программы, скомпилированный под одну или несколько архитектур.</p><p>Коротко разберем что такое <strong>статические</strong> и <strong>динамические</strong> библиотеки. </p><p>В случае <strong>статических библиотек (*.a)</strong> код, используемый приложением, копируется в исполняемый файл во время компиляции. То есть после
компиляции исполняемый файл не нуждается в поддержке внешним кодом или бинарниками, т.к все используемые функции уже находятся в нем.
Конечно это будет и минусом статической библиотеки, ведь если кодовая база изменится, то для работаспособности исполняемого файла его
придется заново перекомпилировать.</p><p><strong>Динамические библиотеки (.dylib)</strong> же отличаются от <strong>статических</strong> тем, что они &quot;линкуются&quot; с исполняемым бинарником, т.е код нашей
библиотеки не попадает в исполняемый файл, а подгружается во время выполнения. В результате размер исполняемого бинарника меньше, а так
как код загружается только в момент обращения к нему, то время запуска обычно уменьшается; но если все динамические библиотеки загружаются
при запуске приложения то это может сильно повлиять на время запуска приложения. </p><p>При попытке отправить ресурсы (такие как строковые файлы, изображения и т. д.) библиотеки iOS/macOS доставляются вместе с пакетами
(Bundle&#x27;s), содержащими эти ресурсы. Об этом мы поговорим дальше.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="статические-и-динамические-библиотеки-в-ios">Статические и динамические библиотеки в iOS<a class="hash-link" href="#статические-и-динамические-библиотеки-в-ios" title="Direct link to heading">​</a></h3><p>Статическая библиотека будет связана с приложением при компиляции, и весь необходимый код будет &quot;вшит&quot; в финальный исполняемый файл. </p><p>Динамически связанные библиотеки не будут изменяться при компиляции - связанные с исполняемым кодом методы загружаются только во время
работы программы</p><p>Динамически связываются большинство системных фреймворков — при создании приложения с помощью <code>UIKit</code> двоичный файл приложения ссылается
на модуль <code>UIKit</code>, но не включает его символы. Система «знает», что версия <code>UIKit</code> будет доступна во время выполнения (и
использует <code>dyld</code>  для ее загрузки). Эта версия используется всеми приложениями и поставляется как часть ОС.</p><p>Откуда система загружает динамическую библиотеку?</p><p>На большинстве других платформ (например, Linux) динамические библиотеки можно использовать для совместного использования между различными
приложениями, совместного использования исполняемых файлов, что значительно экономит память. </p><p>На iOS же до версии 8 Apple не позволяли динамически подгружать сторонние фреймворки, но на поздних версиях разработчикам было разрешено
создавать и использовать условно &quot;динамические&quot; фреймворки. Почему условно? Дело все в том, что хоть это и динамическая структура, но
отличная от системной. Динамическая библиотека, созданная с помощью Cocoa Touch Framework, будет помещена в корневой каталог основного
пакета приложения, когда приложение упаковано, а запущена в &quot;песочница&quot; вместо системы. </p><p>Другими словами основное отличие iOS от остальных платформ, так это то, что разработчик не может установить свои динамические модули в
общем месте и использовать их из разных приложений. Это связано с тем, что приложения работают как бы в «песочнице» и не могут
устанавливать модули в другие части системы. Получается если несколько разных приложений на телефоне используют один и тот же фреймворк,
все равно на устройстве будет несколько его копий, загруженных, упакованных и подписанных по отдельности. </p><p>Однако, из-за всех этих ограничений, функция расширения приложения никуда не делась - вы все еще можете создавать подключаемый модуль для
приложения, с совместным использованием динамических библиотек между модулем и приложением.
Но есть одно важное замечание: в таком случае вы обязательно должны встроить все нужные зависимости в свое приложение. Об этом мы
поговорим чуть позже.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="фреймворки">Фреймворки<a class="hash-link" href="#фреймворки" title="Direct link to heading">​</a></h3><p>Фреймворк - это <strong>пакет (.framework)</strong>, который может содержать в себе предварительно скомпилированный код (библиотеку) c файлами
заголовов (.h), а так же различные ресурсы: файлы локализации, xib&#x27;ки, изображения, storyboard&#x27;ы, bundl&#x27;ы. Фреймворки в iOS и MacOS
организованы в <a href="https://developer.apple.com/library/archive/documentation/CoreFoundation/Conceptual/CFBundles/AboutBundlesAboutBundles.html#//apple_ref/doc/uid/10000123i-CH100-SW1" target="_blank" rel="noopener noreferrer">Bundle&#x27;s</a>.
К ним можно получить доступ через одноименный класс из кода.</p><p>Если фреймворк содержит другой(-ие) фреймворк(-и), то такой фреймворк называют зонтичным (umbrella-framework). Apple настоятельно не
рекомендует создавать свои зонтичные фреймворки, но менеджер зависимостей <strong>CocoaPods</strong> для интеграции активно использует эту концепцию.  </p><h3 class="anchor anchorWithStickyNavbar_mojV" id="линковка">Линковка<a class="hash-link" href="#линковка" title="Direct link to heading">​</a></h3><p>Линковщик или Компоновщик - это программа, которая берет один или несколько объектных файлов (сгенерированных компилятором) и объединяет
их в один исполняемый файл, библиотечный файл или другой «объектный» файл.</p><p>Если вы смотрите журнал сборки Xcode, вы увидите что такая задача как <code>Build target &lt;AppName&gt;</code>
содержит несколько шагов: компиляция исходного кода, а за ней идет линковка, если развернуть команду линковки то можно увидеть следующее:</p><p><img loading="lazy" alt="LinkTask.png" src="/assets/images/LinkTask-edc4e0e580fbb3d81be115ef12a16fa7.png" width="1660" height="706" class="img_E7b_"></p><p>Увидеть наглядно разницу между работой <strong>Динамического</strong> и <strong>Статического</strong> линковщика очень просто. Увидим это на примере создания
статической библиотеки (.o) в Xcode:  <code>File</code> -&gt; <code>New</code> -&gt; <code>Project</code> -&gt; <code>Static Library</code></p><p>После мы увидим следующий код:
<img loading="lazy" alt="Xcode1.png" src="/assets/images/Xcode1-b52089970065129b0332cc451280eb89.png" width="3024" height="1986" class="img_E7b_">
Подключим через SPM модуль <code>swift-algorithms</code>.  В функции <code>foo()</code> используем какой-либо функционал из подключенной зависимости.
Сбилдим бинарник с разным значением <code>Project</code> -&gt; <code>Current Target</code> -&gt; <code>BuildSettings</code> -&gt; <code>Mach-O Type</code> : Dynamic или Static Library.</p><p><img loading="lazy" alt="Xcode2.png" src="/assets/images/Xcode2-3cf0f27a086e589142328ebffe69717e.png" width="3024" height="1986" class="img_E7b_">
Получили две разные статические библиотеки:</p><p><img loading="lazy" alt="Libs.png" src="/assets/images/Libs-a864931756a1c933149d427432cc0d25.png" width="964" height="564" class="img_E7b_"></p><p>В статически слинкованный файл &quot;вшит&quot; код из-из подключенной нами зависимости, из-за этого он имеет наибольший размер. Данный пример
является бесполезным, т.к подключение динамически слинкованной библиотеки без необходимой зависимости в нужном таргете приложения вызовет
краш приложения в рантайме. Но он все же наглядно демострирует работу статической и динамической линковки.</p><p>Чтобы узнать является ли бинарный файл динамически или статически слинкованным достаточно вызвать команду <code>file &lt;binary file&gt;</code>
<img loading="lazy" alt="file_cl.png" src="/assets/images/file_cl-871aa44f8654cfa491ec1f0698946ede.png" width="1524" height="1140" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="встраивание-модулей-в-файл-приложения">Встраивание модулей в файл приложения<a class="hash-link" href="#встраивание-модулей-в-файл-приложения" title="Direct link to heading">​</a></h3><p>Выбрав встраивание модуля в свое приложение в разделе <code>Project</code> -&gt; <code>Targets</code> -&gt; <code>Framework, Libraries and Embedded Content</code> вы активируете
этап сборки <code>Embed Frameworks</code>, который копирует модули в ваше приложение (<code>.app</code> файл будет содержать папку <code>Frameworks</code> со всеми
встроенными модулями)</p><p><img loading="lazy" alt="FrameworkLibsEmbedded.png" src="/assets/images/FrameworkLibsEmbedded-6fbc680acf4b6c5d92ae330a1d7dad46.png" width="1214" height="180" class="img_E7b_"></p><p>Если же вы используете менеджер зависимостей <strong>CocoaPods</strong> то эта задача выполняется в одной из <code>Build Phases</code>: </p><p><img loading="lazy" alt="CocoaPodsEmbed.png" src="/assets/images/CocoaPodsEmbed-0d8efe4c3a80f92dbdbec30b8fc9a002.png" width="1514" height="544" class="img_E7b_"></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ключевые-особенности">Ключевые особенности<a class="hash-link" href="#ключевые-особенности" title="Direct link to heading">​</a></h3><p>Для начало немного терминов:
<strong>Холодный</strong> запуск — это когда приложение давно завершило свою работу и было удалено из кэша операционной системы. Холодный запуск всегда
происходит после перезагрузки приложения и, в принципе, так WWDC рекомендует моделировать его в своих тестах. <strong>Теплый</strong> запуск — это
когда приложение было завершено недавно и данные о запуске не до конца выгружены из памяти.</p><p><strong>Запуск приложения:</strong></p><ul><li>Динамические библиотеки влияют на время холодного запуска приложения, в то время как использование статических библиотек может быть хорошей оптимизацией этого процесса.</li><li>Apple <a href="https://youtu.be/PxV34oZxGLM?t=1781" target="_blank" rel="noopener noreferrer">рекомендовала на WWDC 2016</a> использовать не более 6 динамических фреймворков, но с того времени уже прошло не мало времени и производительность устройств увеличилась. Поэтому советую рассчитывайте это количество так, чтобы
время запуска приложение было оптимальным.</li></ul><p><strong>Размер:</strong></p><ul><li>Самый большой размер приложения: использование динамической компоновки + встраивание модулей в приложение (компилятор не может
оптимизировать, все символы должны быть включены).</li><li>Когда статическая библиотека связана, она будет полностью скопирована в исполняемый файл. Если несколько модулей используют одну и ту
же статическую библиотеку, то код будет попусту копироваться. </li></ul><p><strong>Безопасность запуска:</strong></p><ul><li>Весь статически связанный код проверяется и копируется во время сборки, поэтому у нас есть гарантия, что он работает. Код приложения не
может рассинхронизироваться с API используемой библиотеки. </li><li>Если несколько модулей используют одну и ту же статическую библиотеку, то это может вызвать проблемы из-за дублирования символов в
модуле.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="пример-дублирования-символов">Пример дублирования символов<a class="hash-link" href="#пример-дублирования-символов" title="Direct link to heading">​</a></h3><p>Самый простой пример дублирования символов в исполняемом файле:
есть проект приложения, динамическая библиотека и статическая библиотека (воспользуемся GMaps, т.к они поставляют свою зависимость в виде
статического фреймворка). Подключаем GMaps к нашей динамической библиотеке и приложению, а саму динамическую библиотеку подключаем тоже к
приложению как показано здесь: </p><p><img loading="lazy" alt="dublicate_symbols_podfile" src="/assets/images/dublicate_symbols_podfile-f742a0e11f13f8d7b11cd789fffc021d.png" width="2144" height="1222" class="img_E7b_">
<img loading="lazy" alt="dublicate_symbols_podfile" src="/assets/images/dublicate_symbols_embedded-db55882bba0987ce895ec6b3db6e7240.png" width="2496" height="1446" class="img_E7b_"></p><p>После запуска приложения вы увидите ошибку:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">objc[36567]: Class GMSMapsClearcutClient is implemented in both /private/var/containers/Bundle/Application</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">495A9139-C4DA-4E4E-8677-0E7E49A3B4B6/DublicateSymbolsExample.app/Frameworks/GMapsExt.framework/GMapsExt (0x107580090) and /private/var</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">containers/Bundle/Application/495A9139-C4DA-4E4E-8677-0E7E49A3B4B6/DublicateSymbolsExample.app/DublicateSymbolsExample (0x104e0d660). One</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">of the two will be used. Which one is undefined.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">objc[36567]: Class GMSAPIClientParameters is implemented in both /private/var/containers/Bundle/Application</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">495A9139-C4DA-4E4E-8677-0E7E49A3B4B6/DublicateSymbolsExample.app/Frameworks/GMapsExt.framework/GMapsExt (0x1075800e0) and /private/var</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">containers/Bundle/Application/495A9139-C4DA-4E4E-8677-0E7E49A3B4B6/DublicateSymbolsExample.app/DublicateSymbolsExample (0x104e0d6b0). One</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">of the two will be used. Which one is undefined.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">objc[36567]: Class GMSAddress is implemented in both /private/var/containers/Bundle/Application/495A9139-C4DA-4E4E-8677-0E7E49A3B4B6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DublicateSymbolsExample.app/Frameworks/GMapsExt.framework/GMapsExt (0x107580130) and /private/var/containers/Bundle/Application</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">495A9139-C4DA-4E4E-8677-0E7E49A3B4B6/DublicateSymbolsExample.app/DublicateSymbolsExample (0x104e0d700). One of the two will be used. Which</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">one is undefined.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">objc[36567]: Class GMSAsyncInitServices is implemented in both /private/var/containers/Bundle/Application</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">495A9139-C4DA-4E4E-8677-0E7E49A3B4B6/DublicateSymbolsExample.app/Frameworks/GMapsExt.framework/GMapsExt (0x107580180) and /private/var</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">containers/Bundle/Application/495A9139-C4DA-4E4E-8677-0E7E49A3B4B6/DublicateSymbolsExample.app/DublicateSymbolsExample (0x104e0d750). One</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">of the two will be used. Which one is undefined.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Такое предупреждение говорит о том, что в исполняемом файле дублируются символы, что может привести к некорректной работе приложения или
даже к крашам.</p></div></div><p>Подробней ознакомиться с устройством зависимотей в данном примере вы можете <a href="https://github.com/kramlex/DublicateSymbolsExample" target="_blank" rel="noopener noreferrer">скачав проект с GitHub</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="пример">Пример<a class="hash-link" href="#пример" title="Direct link to heading">​</a></h3><p>Так что же происходит с собранным приложением в реальном проекте с многомодульной / многоцелевой структурой. Рассмотрим пример: </p><p>У нас есть приложение <code>QuizApp</code>, в таргете которого мы видим зависимости на два фреймворка:
<img loading="lazy" alt="QuizAppTarget.png" src="/assets/images/QuizAppTarget-0c88091cbcfae204ce2cc2eec6ffd348.png" width="3024" height="1986" class="img_E7b_">
Как можно заметить, таргет фреймворка может находиться в рамках одного или нескольких проектов Xcode. Также сам файл фреймворка вы можете
встраивать в ваше целевое приложение - Embed (With Signing, Without Signing). </p><p>Чтоб изменить способ линковки фреймворка, например QuizEngine, необходимо перейти в <code>Build Settings -&gt; Mach-O type</code> и выбрать способ
линковки.
<img loading="lazy" alt="MachOFramework.png" src="/assets/images/MachOFramework-144b93eeb0c6621667edb1a601659a9d.png" width="2936" height="1898" class="img_E7b_"> Эксперементируя с разными способами линковки и с тем, нужно ли встраивать
фреймворк в целевое приложение или нет, вы можете получить 4 варианта собранного приложения:
<img loading="lazy" alt="Builded_apps.png" src="/assets/images/Builded_apps-9191e5f1d07ee4c50a57fec28ad42424.png" width="1392" height="760" class="img_E7b_"> </p><ul><li>Статический, встроенный (Embeded) - Приложение в котором команды из QuizEngine будут вшиты в исполняемый файл и наше приложение будет
содержать в себе фреймворк.
<img loading="lazy" alt="StaticEmbedded.png" src="/assets/images/StaticEmbedded-6973950638d8a93687c26aa3e04b089b.png" width="1800" height="1034" class="img_E7b_"> </li><li>Статический, не встроенный (Not Embed) - Приложение в котором команды из QuizEngine будут вшиты в исполняемый файл, но уже оно не будет
содержать фреймворк.
<img loading="lazy" alt="StaticNotEmbed.png" src="/assets/images/StaticNotEmbed-9e59467a67c9bcc65044ed9056f88a36.png" width="1800" height="1034" class="img_E7b_"> </li><li>Динамический, встроенный - код подтягивается во время выполения, из-за чего исполняемый бинарник меньше, фреймворк включен.
<img loading="lazy" alt="DynamicEmbedded.png" src="/assets/images/DynamicEmbedded-363e29d320bd3df28f26fd2ef397c3ce.png" width="1800" height="1034" class="img_E7b_"> </li><li>Статический, не встроенный - код подтягивается во время выполнения, но скомпилированной динамической библиотеки, на которую будет
ссылаться исполняемый файл, нет, поэтому во время выполнения будет ошибка.
<img loading="lazy" alt="DynamicNotEmbed.png" src="/assets/images/DynamicNotEmbed-8b486620886466e2c5e2083c978557d2.png" width="1800" height="1034" class="img_E7b_"> </li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="использование-ресурсов">Использование ресурсов<a class="hash-link" href="#использование-ресурсов" title="Direct link to heading">​</a></h3><p>Как мы уже говорили выше, iOS framework&#x27;и умеют хранить в себе ресурсы, и сейчас мы поймем как с ними рабоать.
При статической и динамической линковке фреймворка есть разница в работе с ресурсами.
Если фреймворк динамический то нам без разницы втроили мы его в приложение или нет, сам фреймворк будет установлен вместе с приложением
в пространство устройства, и подргружен в нужный момент. Благодаря этому мы всегда сможем получить его Bundle для доступа к ресурсам.</p><p>Со статической линковкой все хуже - даже если мы встроим фреймворк в конечный .app файл - логика Embed (with Sing, without Sign) в Xcode. </p><p><img loading="lazy" alt="res-embed" src="/assets/images/res-embedded-8557f788f4cb806f1711af1ecf1ec357.png" width="1722" height="462" class="img_E7b_"></p><p>Все равно мы не сможем получить необходимый Bundle для доступа к ресурсам, все из-за того что классы для поиска Bundle
будут добавлены в основной исполняемый файл.</p><p>Разберемся на примере: </p><p>Например, у нас к проекту подключен фреймворк (статически или динамически, не важно). В фреймворке мы создали класс
кастомной UIVIew - <code>SuperHardView</code>, который будет отображать картинку <code>trollface.png</code>, которая лежит в ассетах нашего
фреймворка:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import UIKit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">public class SuperHardView: UIView {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private let imageView: UIImageView = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let imageView = UIImageView()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        imageView.contentMode = .scaleAspectFill</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return imageView</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    public override init(frame: CGRect) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.init(frame: frame)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        translatesAutoresizingMaskIntoConstraints = false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        addSubview(imageView)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        imageView.translatesAutoresizingMaskIntoConstraints = false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSLayoutConstraint.activate([</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            imageView.centerXAnchor.constraint(equalTo: self.centerXAnchor),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            imageView.centerYAnchor.constraint(equalTo: self.centerYAnchor),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            imageView.heightAnchor.constraint(equalToConstant: 100),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            imageView.widthAnchor.constraint(equalToConstant: 100)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        setupView()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    required init?(coder: NSCoder) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fatalError(&quot;init(coder:) has not been implemented&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private func setupView() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let bundle = Bundle(for: Self.self)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        guard let image = UIImage(named: &quot;trollface&quot;, in: bundle, compatibleWith: nil) else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            fatalError(&quot;Missing image...&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        imageView.image = image</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Внутри <code>ViewController&#x27;а</code>, который находится в нашем основном модуле, создадим экземпляр <code>SuperHardView</code>
и добавим его на экран:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">import UIKit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">import ViewKit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class ViewController: UIViewController {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override func viewDidLoad() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.viewDidLoad()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        setup()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private func setup() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let superHardView = SuperHardView()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        view.addSubview(superHardView)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSLayoutConstraint.activate([</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            superHardView.leadingAnchor.constraint(equalTo: view.leadingAnchor),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            superHardView.trailingAnchor.constraint(equalTo: view.trailingAnchor),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            superHardView.topAnchor.constraint(equalTo: view.topAnchor),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            superHardView.bottomAnchor.constraint(equalTo: view.bottomAnchor)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ])</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>При динамической линковке после запуска приложения мы увидим, что подгрузка ресурсов прошла успешно: </p><p><img loading="lazy" alt="trollface-app" src="/assets/images/trollface-app-d6677d80f4912be897c3808a68083a46.png" width="1080" height="2340" class="img_E7b_"></p><p>Если мы попробуем слинковать наш фреймворк статически, то после запуска приложения появится ошибка, по заранее
описаной причине:</p><p><img loading="lazy" alt="missing-image" src="/assets/images/missing-image-0a352a06854f9111103ae7a66ec9ca5a.png" width="2242" height="1614" class="img_E7b_"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Все же есть способы упаковать файлы ресурсов в статический фреймворк, об этом вы можете почитать <a href="https://09mejohn.medium.com/resource-bundles-in-ios-static-library-beba3070fafd" target="_blank" rel="noopener noreferrer">здесь</a> или в интернете.</p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cocoapods">CocoaPods<a class="hash-link" href="#cocoapods" title="Direct link to heading">​</a></h3><p>По умолчанию CocoaPods (без упоминания <code>use_frameworks!</code>) будет создавать и связывать все зависимости как статические библиотеки. Если мы
добавим  атрибут <code>use_frameworks!</code> в Podfile, <strong>CocoaPods</strong> вместо этого создаст и свяжет отмеченные зависимости как динамические
фреймворки.
С появлением XCFramework пояивлась возможность указывать тип линковки для конкретных таргетов.
<img loading="lazy" alt="pod_static_dynamic.png" src="/assets/images/pod_static_dynamic-88b71ed4fb544cca3fb8802117bb98bb.png" width="1210" height="894" class="img_E7b_"> </p><div class="admonition admonition-important alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>important</h5></div><div class="admonition-content"><p>Это все связано только с зависимостями, которые <strong>CocoaPods</strong> создает из исходного кода. Если вы ссылаетесь на уже скомпонованный модуль, то
<strong>CocoaPods</strong> никак не может изменить способ линковки данного модуля. </p></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="выводы">Выводы<a class="hash-link" href="#выводы" title="Direct link to heading">​</a></h3><p>После ознакомления со статьей вы наверное уже догадались, что единствено правильного способа устраивать зависимости в iOS проекте нет, и
вам нужно выбирать то, что лучше поможет вам решить поставленную перед вами задачу. Но есть несколько советов:</p><ul><li><p>Если проблема заключается во времени запуска приложения, то вам на помощь придут статические библиотеки, которые &quot;вшиваются&quot; в исполняемый файл при компиляции и не вызывают диначеский загрузчик во время выполнения (именно он увеличивает время запуска).</p></li><li><p>Если задача состоит в уменьшении размера приложения, то статические библиотеки дадут лучший результат при правильном использовании, т.к при линковке произойдут некоторые оптимизаации и в исполняемый бинарник будут помещены только необходимые символы.</p></li><li><p>Если же необходимо расшарить код между модулями, то достатоно сделать динамический фреймворк, который будет подгружаться в память всего один раз, а зависимые от него модули будут просто ссылаться на него.</p></li><li><p>Использование статических библиотек всегда безопаснее, ведь все символы разрешаются во время сборки; использование динамических библиотек рискованно, так как динамические модули могут быть исключены из бинарного файла (если они неправильно настроены), из чего будет следовать сбой во время выполнения.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="материалы">Материалы<a class="hash-link" href="#материалы" title="Direct link to heading">​</a></h3><ul><li><a href="https://www.youtube.com/watch?v=IqsKGyklmL0" target="_blank" rel="noopener noreferrer">Essential Developer - # Differences in Dynamic &amp; Static Frameworks/Libraries</a></li><li><a href="https://github.com/essentialdevelopercom/quiz-app" target="_blank" rel="noopener noreferrer">Example Sources</a></li></ul><ul><li><a href="https://youtu.be/PxV34oZxGLM" target="_blank" rel="noopener noreferrer">WWDC 2016 - Optimizing app startup time</a></li><li><a href="https://medium.com/microsoft-mobile-engineering/mixing-static-and-dynamic-linking-in-cocoapods-83b6d4252c59#:~:text=CocoaPods%20pod%2Dlinkage%20plugin&amp;text=In%20SwiftKey%2C%20we%20have%20a,app%20and%20keyboard%20extension%20too." target="_blank" rel="noopener noreferrer">Mixing static and dynamic linking in CocoaPods</a></li><li><a href="https://russianblogs.com/article/71841604682/" target="_blank" rel="noopener noreferrer">Статическая/динамические библиотеки в iOS </a></li><li><a href="https://bpoplauschi.github.io/2021/10/24/Intro-to-static-and-dynamic-libraries-frameworks.html" target="_blank" rel="noopener noreferrer">Введение в статические и динамические библиотеки и фреймворки на iOS</a></li></ul><div style="text-align:right">Автор: <a href="https://github.com/kramlex" target="_blank" rel="noopener noreferrer">@kramlex</a></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/icerockdev/kmm.icerock.dev/tree/docusaurus/learning/ios/static-dynamic-libs.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/learning/ios/sign_in_with_apple"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Sign in with Apple</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/learning/ios/xcode-environment-variables"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Xcode - environment variables</div></a></nav><br></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#введение" class="table-of-contents__link toc-highlight">Введение</a></li><li><a href="#определения" class="table-of-contents__link toc-highlight">Определения</a></li><li><a href="#статические-и-динамические-библиотеки-в-ios" class="table-of-contents__link toc-highlight">Статические и динамические библиотеки в iOS</a></li><li><a href="#фреймворки" class="table-of-contents__link toc-highlight">Фреймворки</a></li><li><a href="#линковка" class="table-of-contents__link toc-highlight">Линковка</a></li><li><a href="#встраивание-модулей-в-файл-приложения" class="table-of-contents__link toc-highlight">Встраивание модулей в файл приложения</a></li><li><a href="#ключевые-особенности" class="table-of-contents__link toc-highlight">Ключевые особенности</a></li><li><a href="#пример-дублирования-символов" class="table-of-contents__link toc-highlight">Пример дублирования символов</a></li><li><a href="#пример" class="table-of-contents__link toc-highlight">Пример</a></li><li><a href="#использование-ресурсов" class="table-of-contents__link toc-highlight">Использование ресурсов</a></li><li><a href="#cocoapods" class="table-of-contents__link toc-highlight">CocoaPods</a></li><li><a href="#выводы" class="table-of-contents__link toc-highlight">Выводы</a></li><li><a href="#материалы" class="table-of-contents__link toc-highlight">Материалы</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">IceRock Development</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Site</a></li><li class="footer__item"><a href="https://github.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://www.facebook.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://vk.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">VK</a></li><li class="footer__item"><a href="https://www.instagram.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC-Vhmm09W_IWKHhSg80d68w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a href="https://twitter.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter @icerockdev<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/kotlinmpp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmpp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/kotlinmppchats" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmppchats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kotlinlang.org/lp/mobile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Mobile<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://libs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Libs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://codelabs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Codelabs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://moko.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">MOKO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/native-overview.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin/Native Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/multiplatform.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 IceRock Development. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.12c44d84.js"></script>
<script src="/assets/js/main.295e8f0e.js"></script>
</body>
</html>