<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-university docs-doc-id-icerock-basics/mvvm">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-91G2XYQTXS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-91G2XYQTXS",{})</script><title data-rh="true">MVVM | Kotlin Multiplatform Mobile</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://kmm.icerock.dev/university/icerock-basics/mvvm"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-university-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-university-current"><meta data-rh="true" property="og:title" content="MVVM | Kotlin Multiplatform Mobile"><meta data-rh="true" name="description" content="Выбор подхода"><meta data-rh="true" property="og:description" content="Выбор подхода"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kmm.icerock.dev/university/icerock-basics/mvvm"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/university/icerock-basics/mvvm" hreflang="en"><link data-rh="true" rel="alternate" href="https://kmm.icerock.dev/university/icerock-basics/mvvm" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.893f3d2c.css">
<link rel="preload" href="/assets/js/runtime~main.1d3f69da.js" as="script">
<link rel="preload" href="/assets/js/main.1adb8873.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/onboarding/intro">Onboarding</a><a class="navbar__item navbar__link" href="/learning/intro">Knowledge Base</a><a class="navbar__item navbar__link navbar__link--active" href="/university/intro">University</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/icerockdev/kmm.icerock.dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><aside class="theme-doc-sidebar-container docSidebarContainer_UQUJ"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/university/intro">IceRock KMM University</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/android-basics/android-intro">1. Основы разработки Android приложений</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/ios-basics/ios-intro">2. Основы разработки iOS приложений</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/kotlin-multiplatform-mobile/kmm-intro">3. Основы разработки Kotlin Multiplatform Mobile</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/university/icerock-basics/icerock-intro">4. Основы мобильной разработки в IceRock</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/icerock-intro">Вводная</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/mobile-moko-boilerplate">Шаблон для новых проектов</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/gradle">Gradle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/multimodularity">Многомодульность</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/moko-libs-intro">Введение в MOKO библиотеки</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/di">Внедрение зависимостей</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/university/icerock-basics/mvvm">MVVM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/resources-in-common">Ресурсы в общем коде</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/navigation">Навигация между экранами</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/ios-resources">Ресурсы на iOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/ui-units">Построение экранов вертикальными списками</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/logging-and-errors">Логирование и обработка ошибок</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/android-just-like-ios">Android ≈ iOS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/repository">Реактивный источник данных</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/mock-engine">Мокирование данных</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/entities">Сущности приложения</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/university/icerock-basics/practice">Практическое задание</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/filling-fields/intro">5. Реализация форм ввода данных</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/lists/intro">6. Реализация списков с данными</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/network/intro">7. Передача данных по сети</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/data-storage/intro">8. Хранение данных</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/runtime-permissions/intro">9. Runtime permissions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/push-notifications/intro">10. Push notifications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/university/memos/best-practices">Памятки для разработчика</a></div></li></ul></nav></div></aside><main class="docMainContainer_uL0j"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_kU5B"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">4. Основы мобильной разработки в IceRock</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MVVM</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><h1>MVVM</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="выбор-подхода">Выбор подхода<a class="hash-link" href="#выбор-подхода" title="Direct link to heading">​</a></h2><p>Когда мы начинали внедрять Kotlin Multiplatform в разработку проектов мы стремились максимально избавиться от дублирования между платформами, но не вредя конечному UI и UX (оставляя его полностью нативным и привычным пользователям). Проведя некоторое исследование решили, что паттерн <strong>Model-View-ViewModel</strong>, который мы уже активно применяли на Android, <strong>наиболее хорошо подойдет для переиспользования</strong> между платформами. </p><p><em>На тот момент декларативного UI в виде SwiftUI и Jetpack Compose еще не было, поэтому рассматривалось удобство и надежность интеграции с обычными <code>View</code>.</em></p><p>В результате, мы имеем в общей Kotlin Multiplatform библиотеке:</p><ul><li>Для каждого экрана ViewModel с логикой работы</li><li>Работа с сетью</li><li>Работа с базой данных</li><li>Процессинг данных, преобразования, расчеты</li></ul><p>И остается на стороне платформы - верстка UI, привязка к общим ViewModel и навигация.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>С самим подходом MVVM вы уже знакомились в разделе Android. Для освежения памяти особо полезно будет перечитать статью <a href="/learning/state">Единый стейт экрана</a></p></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="moko-mvvm">moko-mvvm<a class="hash-link" href="#moko-mvvm" title="Direct link to heading">​</a></h2><p>Для использования MVVM мы реализовали библиотеку <a href="https://github.com/icerockdev/moko-mvvm" target="_blank" rel="noopener noreferrer">moko-mvvm</a>. Главное, что мы стремились достичь при ее реализации, это использование оригинальных классов JetPack <code>ViewModel</code> и <code>LiveData</code> со стороны Android, чтобы продолжить использовать существующие в Android интеграции с данными классами (включая логику хранения <code>ViewModel</code> в <code>ViewModelStore</code> чтобы переживать смену конфигурации). Для iOS стороны (и других платформ тоже) классы <code>ViewModel</code> и <code>LiveData</code> были реализованы нами, в более простом виде чем в Android (так как только в Android есть сложный жизненный цикл компонентов с пересозданием). По сути классы <code>ViewModel</code> и <code>LiveData</code> являются expect классами с разными actual реализациями на платформах.</p><p>Для знакомства с библиотекой посмотрите материалы на странице в базе знаний - <a href="/learning/libraries/moko/moko-mvvm">moko-mvvm</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="привязка-livedata-к-ui">Привязка LiveData к UI<a class="hash-link" href="#привязка-livedata-к-ui" title="Direct link to heading">​</a></h3><p>В библиотеке также содержатся готовые методы для привязки <code>LiveData</code> к UI элементам, по аналогии с методами, которые были использованы нами в <a href="/learning/state">статье про State</a>. Данные методы доступны и для Android и для iOS, а поэтому в большинстве случаев вам не потребуется писать вручную привязку каждого типа данных к каждому UI элементу.</p><p>Привязкой UI к <code>LiveData</code> называется binding, и основано на использовании метода <code>bind</code>:</p><ul><li><a href="https://github.com/icerockdev/moko-mvvm/blob/master/mvvm-livedata/src/androidMain/kotlin/dev/icerock/moko/mvvm/utils/LiveDataExt.kt" target="_blank" rel="noopener noreferrer">для Android</a></li><li><a href="https://github.com/icerockdev/moko-mvvm/blob/master/mvvm-livedata/src/iosMain/kotlin/dev/icerock/moko/mvvm/utils/LiveDataExt.kt" target="_blank" rel="noopener noreferrer">для iOS</a></li></ul><p>Для Android нам доступны например:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fun EditText.bindTextTwoWay(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lifecycleOwner: LifecycleOwner,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    liveData: MutableLiveData&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">): Closeable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fun TextView.bindText(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lifecycleOwner: LifecycleOwner,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    liveData: LiveData&lt;String&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">): Closeable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fun View.bindVisibleOrGone(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lifecycleOwner: LifecycleOwner,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    liveData: LiveData&lt;Boolean&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">): Closeable</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>И для iOS соответственно:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">extension UITextField {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @discardableResult</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  func bindTextTwoWay(liveData: MutableLiveData&lt;NSString&gt;) -&gt; Closeable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">extension UILabel {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @discardableResult</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  func bindText&lt;T : NSString&gt;(liveData: LiveData&lt;T&gt;) -&gt; Closeable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">extension UIView {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @discardableResult</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  func bindHidden(liveData: LiveData&lt;KotlinBoolean&gt;) -&gt; Closeable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="пример">Пример<a class="hash-link" href="#пример" title="Direct link to heading">​</a></h4><p>shared code:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class SimpleViewModel : ViewModel() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private val _counter: MutableLiveData&lt;Int&gt; = MutableLiveData(0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val counter: LiveData&lt;String&gt; = _counter.map { it.toString() }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fun onCounterButtonPressed() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _counter.value += 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>android app: </p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class SimpleFragment: Fragment(R.layout.fragment_simple) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.onViewCreated(view, savedInstanceState)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        val viewModel: SimpleViewModel = getViewModel { SimpleViewModel() }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        val binding = FragmentSimpleBinding.bind(view)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        binding.counterText.bindText(viewLifecycleOwner, viewModel.counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        binding.incrementButton.setOnClickListener { viewModel.onCounterButtonPressed() }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ios app:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class SimpleViewController: UIViewController {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @IBOutlet private var counterLabel: UILabel!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private var viewModel: SimpleViewModel!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override func viewDidLoad() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.viewDidLoad()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        viewModel = SimpleViewModel()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        counterLabel.bindText(liveData: viewModel.counter)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @IBAction func onCounterButtonPressed() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        viewModel.onCounterButtonPressed()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="добавление-своих-расширений">Добавление своих расширений<a class="hash-link" href="#добавление-своих-расширений" title="Direct link to heading">​</a></h4><p>Если в <code>moko-mvvm</code> не оказалось нужной вам функции биндинга для <code>iOS</code> или <code>Android</code>, вы можете добавить свой <code>extension</code> к <code>LiveData</code>.<br>
<!-- -->Например, добавим функцию <code>bindToMenuItemVisible</code> для связи <code>LiveData&lt;Boolean&gt;</code> и <code>MenuItem</code> на <code>Android</code>:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">internal fun LiveData&lt;Boolean&gt;.bindToMenuItemVisible(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lifecycleOwner: LifecycleOwner,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    menuItem: MenuItem</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">): Closeable {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return bindNotNull(lifecycleOwner) { value -&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        menuItem.isVisible = value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Для <code>iOS</code> добавим функцию <code>bindToUIToolbarVisible</code> для связи <code>UIToolbar</code> c <code>LiveData&lt;KotlinBoolean&gt;</code> (на <code>iOS</code> из общего кода вместо <code>Boolean</code> приходит <code>KotlinBoolean</code>) вот как это будет выглядеть:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">extension UIToolbar {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    func bindToUIToolbarVisible(liveData: LiveData&lt;KotlinBoolean&gt;) -&gt; Closeable {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return liveData.addCloseableObserver { [weak self] value in</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            let kotlinBool = value as! KotlinBoolean</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            self?.isHidden = kotlinBool.boolValue</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Важно, в методах биндинга должна быть только привязка <code>liveData</code> к объекту <code>UI</code>, никакой логики быть не должно!
Вся логика должна быть во <code>ViewModel</code>, если нужно как-то преобразовать значение <code>liveData</code>, делайте это там.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="mvvmactivity-и-mvvmfragment">MvvmActivity и MvvmFragment<a class="hash-link" href="#mvvmactivity-и-mvvmfragment" title="Direct link to heading">​</a></h3><p>В moko-mvvm реализованы абстрактные классы <a href="https://github.com/icerockdev/moko-mvvm/blob/b4b2ed1a86451bd303aa0733ecd776be96c6f455/mvvm-viewbinding/src/main/kotlin/dev/icerock/moko/mvvm/viewbinding/MvvmEventsFragment.kt" target="_blank" rel="noopener noreferrer">MvvmFragment</a> и <a href="https://github.com/icerockdev/moko-mvvm/blob/b6f2630df03bbd405e5659d85ea7df03f38e5dc7/mvvm-viewbinding/src/main/kotlin/dev/icerock/moko/mvvm/viewbinding/MvvmActivity.kt" target="_blank" rel="noopener noreferrer">MvvmActivity</a>, наследуясь от которых вы:</p><ul><li>автоматически получите доступ к <code>binding</code> и <code>viewModel</code> </li></ul><p>Пример фрагмента, наследника обычного Fragment:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@AndroidEntryPoint</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class TestFragment : Fragment() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private var _binding: TestFragmentBinding? = null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private val binding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        get() = _binding!!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @Inject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    lateinit var testFactory: TestFactory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private lateinit var viewModel: TestViewModel</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onCreate(savedInstanceState: Bundle?) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.onCreate(savedInstanceState)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        viewModel = getViewModel {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            testFactory.createTestViewModel()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onCreateView(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        inflater: LayoutInflater,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        container: ViewGroup?,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        savedInstanceState: Bundle?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ): View {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _binding = TestFragmentBinding.inflate(inflater, container, false)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return binding.root</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.onViewCreated(view, savedInstanceState)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        binding.testLayout.bindFormField(viewLifecycleOwner, viewModel.testText)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onDestroyView() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.onDestroyView()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _binding = null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>А теперь тот же самый фрагмент, но наследник MvvmFragment: </p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@AndroidEntryPoint</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">class TestFragment : MvvmFragment&lt;TestFragmentBinding, AuthViewModel&gt;() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  @Inject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  lateinit var testFactory: TestFactory</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  override val viewModelClass: Class&lt;AuthViewModel&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    get() = AuthViewModel::class.java</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun viewBindingInflate(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    inflater: LayoutInflater,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    container: ViewGroup?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ): TestFragmentBinding = TestFragmentBinding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .inflate(inflater, container, false)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun viewModelFactory(): ViewModelProvider.Factory = ViewModelFactory {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    testFactory.createTestViewModel()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  override fun onViewCreated(view: View, savedInstanceState: Bundle?) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    binding.testLayout.bindFormField(viewLifecycleOwner, viewModel.testText)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="передача-событий-из-viewmodel-на-ui">Передача событий из ViewModel на UI<a class="hash-link" href="#передача-событий-из-viewmodel-на-ui" title="Direct link to heading">​</a></h3><p>Для начала, освежите в памяти что такое <a href="/learning/state#%D1%81%D0%BE%D0%B1%D1%8B%D1%82%D0%B8%D0%B5-%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5">события/действия</a>, для чего они нужны и как реализуются на Android.
За всю логику в приложении, в том числе и за принятие решения, когда нужно перейти на другой экран отвечает <code>ViewModel</code>. Поэтому <code>ViewModel</code> должна как-то сообщать <code>Fragment</code>-у или <code>UIViewController</code>-y, что нужно выполнить какое-то действие (<code>Action</code>).</p><p>Разберем несколько подходов для передачи событий от <code>ViewModel</code> на UI:</p><ul><li>используя <code>Flow</code></li><li>используя <code>EventsDispatcher</code> из <a href="https://github.com/icerockdev/moko-mvvm" target="_blank" rel="noopener noreferrer">moko-mvvm</a></li><li>используя <code>Flow</code> вместе с <a href="https://github.com/icerockdev/moko-kswift" target="_blank" rel="noopener noreferrer">moko-kswift</a></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="flow">Flow<a class="hash-link" href="#flow" title="Direct link to heading">​</a></h4><p>В <a href="/learning/state">статье</a> про состояния и события вы уже ознакомились с передачей событий на Android используя Flow APIs.<br>
<!-- -->Однако, теперь нам нужно отправлять такие действия из общего кода, который потом подключится к iOS и Android приложениям.  </p><p><strong>Первая проблема</strong> заключается в том, что на iOS не удастся использовать Flow APIs, потому что <code>Flow</code> - это interface с generic типом, который после компиляции Kotlin/Native со стороны Swift generic тип исчезнет и будет просто protocol <code>Flow</code>.  </p><p><strong>Вторая проблема</strong> - <code>sealed interface</code> нельзя использовать в <code>switch</code> на iOS также, как мы используем его в <code>when</code> на Kotlin. Чтобы использовать его в <code>switch</code> нужно чтобы он был <code>enum</code>-ом.</p><p>Рассмотрим на примере:</p><p>Допустим, у нас для переходов между экранами во <code>ViewModel</code> объявлен вот такой <code>sealed interface</code>:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">sealed interface Action {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  object RouteToMainScreen : Action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  object RouteToAuthScreen : Action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  object RouteToSettingsScreen : Action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>При необходимости перейти на другой экран <code>ViewModel</code> помещает во <code>Flow</code> объекты <code>Action</code>. <code>Fragment</code> и <code>UIViewController</code> подписываются на этот <code>Flow</code>, и, когда он получает новый объект, определяют по нему на какой экран переходить.</p><p>Представим, что мы подписались на <code>Flow</code> в <code>Fragment</code>: каждый новый объект обрабатывается <code>when</code>-ом. Если все объекты из <code>sealed interface</code>-а обработаны в <code>when</code>, то на Android ветка <code>else</code> не потребуется.  </p><p>В iOS же, <code>sealed interface</code> не преобразуется в <code>enum</code>, из-за чего даже при переборе всех объектов в <code>switch</code>, нужно будет добавить ветку <code>else</code>.<br>
<!-- -->Теперь, предположим, что нам понадобилось добавить еще один объект в <code>Action</code> для событий, которые кидает <code>ViewModel</code>.<br>
<!-- -->В Kotlin-мире мы получим ошибку при компиляции, надо будет добавить в <code>when</code> обработку еще одного объекта - нового, который только что добавили во <code>ViewModel</code>.<br>
<!-- -->А на iOS компилятор нам ничего не подскажет, потому что новый объект будет обрабатываться в ветке <code>else</code>. Из-за этого, логика перехода на iOS нарушится. Поиск ошибки может занять некоторое время, в зависимости от знаний разработчика.  </p><p>Чтобы не сталкиваться с этим на практике мы долгое время использовали другой подход - с помощью <code>EventsDispatcher</code> из <a href="https://github.com/icerockdev/moko-mvvm" target="_blank" rel="noopener noreferrer">moko-mvvm</a>. Разберемся, как он работает.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="eventsdispatcher">EventsDispatcher<a class="hash-link" href="#eventsdispatcher" title="Direct link to heading">​</a></h4><p>С этим подходом нужно разобраться, потому что на многих наших проектах сейчас используется именно он.<br>
<code>EventDispatcher</code> - это класс с одной единственной задачей - гарантировать доставку события и вызов его обработчика на UI, после сигнала от <code>ViewModel</code>.</p><p>Во <code>ViewModel</code> объявляется интерфейс с методами, реализация которых ей нужна на платформе, например, метод для перехода на какой-нибудь экран:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface EventsListener {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fun routeToMainPage()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Далее, все что остается сделать, чтобы вызвать событие на <code>UI</code> - это получить во <code>ViewModel</code> объект <code>eventsDispatcher</code> и, когда пора переходить на главный экран, послать платформе это событие простым вызовом метода:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class EventsViewModel(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    val eventsDispatcher: EventsDispatcher&lt;EventsListener&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) : ViewModel() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fun onButtonPressed() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        eventsDispatcher.dispatchEvent { routeToMainPage() }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    interface EventsListener {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fun routeToMainPage()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>На платформах <code>Fragment</code> и <code>UIViewController</code> реализуют этот интерфейс.
Пример реализации на Android:</p><div class="language-kotlin codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-kotlin codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class EventsFragment: Fragment(R.layout.fragment_simple), EventsViewModel.EventsListener {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.onViewCreated(view, savedInstanceState)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        val viewModel: EventsViewModel = getViewModel { </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            EventsViewModel(eventsDispatcherOnMain()) </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        viewModel.eventsDispatcher.bind(lifecycleOwner = this, listener = this)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun routeToMainPage() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        TODO(&quot;some routing&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Пример на iOS:</p><div class="language-swift codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-swift codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">class EventsViewController: UIViewController {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    private var viewModel: EventsViewModel!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    override func viewDidLoad() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        super.viewDidLoad()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        viewModel = EventsViewModel(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            eventsDispatcher: EventsDispatcher(listener: self)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">extension EventsViewController: EventsViewModelEventsListener {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    func routeToMainPage() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        fatalError(&quot;some routing&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>За счет интерфейса обе платформы знают, какой набор действий должны поддерживать.<br>
<!-- -->Если во <code>ViewModel</code> нужно будет добавить еще одно событие, и мы забудем реализовать его на какой-нибудь из платформ, компилятор выделит, что отсутствует реализация метода интерфейса.</p><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>В <code>dispatchEvent</code> нельзя передавать лямбду из общего кода, например, для установки действия по кнопке в <a href="https://developer.android.com/reference/android/app/AlertDialog" target="_blank" rel="noopener noreferrer">AlertDialog</a>. Нельзя этого делать потому, что на Android мы не сможем ее никуда сохранить, поэтому при пересоздании экрана она пропадет.<br>
<!-- -->Если вам нужно установить чему-либо на платформе действие - делайте соответствующий метод во <code>ViewModel</code>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="flow-c-moko-kswift">Flow c moko-kswift<a class="hash-link" href="#flow-c-moko-kswift" title="Direct link to heading">​</a></h4><p>Мы уже рассмотрели, с какими проблемами мы столкнулись бы, если бы использовали <code>Flow</code> в общем коде.<br>
<!-- -->Разберем теперь, как можно решить эти проблемы, начнем с отсутствия типов у <code>Flow</code> на iOS.</p><p>Мы будем использовать классы-обертки <code>CFlow</code> и <code>CStateFlow</code> из <a href="https://github.com/icerockdev/moko-mvvm" target="_blank" rel="noopener noreferrer">moko-mvvm</a>, а также функции, позволяющие преобразовать в них <code>Flow</code> и <code>StateFlow</code>.</p><p><code>CFlow</code> и <code>CStateFlow</code> - это те же самые <code>Flow</code> и <code>StateFlow</code>, только в виде классов. Сделаны они были для того, чтобы использовать именно классы, потому что для классов в Swift generic типы доступны.<br>
<!-- -->В common-коде мы будем использовать <code>CFlow</code> и <code>CStateFlow</code> только для public API, а в внутренней реализации общего кода нет нужды использовать классы вместо интерфейсов - можно будет использовать обычное <code>Flow</code> API.<br>
<!-- -->Таким образом, мы решили первую проблему - отсутствие типов у <code>Flow</code> на iOS.</p><p>Теперь разберемся со второй проблемой - преобразованием <code>sealed interface</code> к <code>enum</code> в Swift.</p><p>Используя плагин <a href="https://github.com/icerockdev/moko-kswift" target="_blank" rel="noopener noreferrer">moko-kswift</a>, мы можем получать автоматически генерируемые Swift <code>enum</code>, соответствующие <code>sealed-interface</code>-ам общего кода, а после работать с ними в <code>switch</code>.<br>
<!-- -->Для более полного понимания проблемы и её решения, изучите <a href="/learning/libraries/moko/moko-kswift">страницу</a> плагина в базе знаний.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="удобное-public-api-общего-кода">Удобное public api общего кода<a class="hash-link" href="#удобное-public-api-общего-кода" title="Direct link to heading">​</a></h2><p>Благодаря переносу всей логики приложения в общий код мы получаем более удобное и простое API библиотеки для интеграции на платформы. Мы знаем что есть, например, ряд <code>ViewModel</code>-ей, в которых есть <code>LiveData</code> на которые нужно подписаться и <code>EventsDispatcher</code> события от которого нужно обрабатывать. Все передаваемые на UI данные уже подготовлены к отображению и не требуют дополнительной обработки.</p><p>Вот некоторый список преимуществ, которые мы получаем за счет использования <code>ViewModel</code>-ей в общем коде:</p><ul><li>Вся обработка ошибок (<code>Exception</code>) внутри Kotlin кода, на UI привязываются строки с текстом - нам не надо на Swift пытаться распознать что такое <code>KotlinException</code>;</li><li><code>suspend</code> функции все внутри Kotlin кода.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="практическое-задание">Практическое задание<a class="hash-link" href="#практическое-задание" title="Direct link to heading">​</a></h2><ul><li>Используйте проект, готовый после раздела <a href="/university/icerock-basics/di#%D0%BF%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5">Внедрение зависимостей</a></li><li>Подключите библиотеку <code>moko-mvvm</code></li><li>Подключите плагин <code>moko-kswift</code></li><li>Добавьте в ваши фичи репозиторий, необходимые классы и вьюмодели, которые вы делали в третьем блоке для Android, все вьюмодели наследуйте от <code>ViewModel</code> из <code>moko-mvvm</code><ul><li>Ориентируйтесь на классы из практики 3его блока и <a href="/university/icerock-basics/practice#%D0%BA%D0%BB%D0%B0%D1%81%D1%81%D1%8B-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F">диаграмму классов mpp-library</a></li><li>Используйте <code>CFlow</code> и <code>CStateFlow</code> для для <code>state</code> public API</li></ul></li><li>Добавьте необходимые фрагменты в Android-приложение, фрагменты наследуйте от <code>MvvmFragment</code> из <code>moko-mvvm</code>, ориентируйтесь на практику 3 блока</li><li>Добавьте необходимые <code>ViewController</code>-ы в iOS приложение, все <code>ViewController</code>-ы наследуйте от <code>MVVMController</code> из <code>moko-mvvm</code></li><li>Подключите вьюмодели к iOS и Android</li><li>Настройте Android и iOS приложения - их логикой, кроме управления списков, должен управлять общий код</li><li>Приложения должны запускаться</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/icerockdev/kmm.icerock.dev/tree/docusaurus/university/4-icerock-basics/mvvm.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/university/icerock-basics/di"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Внедрение зависимостей</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/university/icerock-basics/resources-in-common"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Ресурсы в общем коде</div></a></nav><br></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#выбор-подхода" class="table-of-contents__link toc-highlight">Выбор подхода</a></li><li><a href="#moko-mvvm" class="table-of-contents__link toc-highlight">moko-mvvm</a><ul><li><a href="#привязка-livedata-к-ui" class="table-of-contents__link toc-highlight">Привязка LiveData к UI</a></li><li><a href="#mvvmactivity-и-mvvmfragment" class="table-of-contents__link toc-highlight">MvvmActivity и MvvmFragment</a></li><li><a href="#передача-событий-из-viewmodel-на-ui" class="table-of-contents__link toc-highlight">Передача событий из ViewModel на UI</a></li></ul></li><li><a href="#удобное-public-api-общего-кода" class="table-of-contents__link toc-highlight">Удобное public api общего кода</a></li><li><a href="#практическое-задание" class="table-of-contents__link toc-highlight">Практическое задание</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">IceRock Development</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Site</a></li><li class="footer__item"><a href="https://github.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://www.linkedin.com/company/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn</a></li><li class="footer__item"><a href="https://www.facebook.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook</a></li><li class="footer__item"><a href="https://vk.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">VK</a></li><li class="footer__item"><a href="https://www.instagram.com/icerockdevelopment" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UC-Vhmm09W_IWKHhSg80d68w" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li><li class="footer__item"><a href="https://twitter.com/icerockdev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter @icerockdev<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/kotlinmpp" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmpp<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/kotlinmppchats" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram @kotlinmppchats<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Community<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://kotlinlang.org/lp/mobile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Mobile<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://libs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Libs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://codelabs.kmp.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Codelabs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://moko.icerock.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">MOKO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/native-overview.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin/Native Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://kotlinlang.org/docs/reference/multiplatform.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kotlin Multiplatform Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 IceRock Development. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.1d3f69da.js"></script>
<script src="/assets/js/main.1adb8873.js"></script>
</body>
</html>